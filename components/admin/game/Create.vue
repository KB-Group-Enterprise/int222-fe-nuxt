<template>
  <AdminGameForm @save="sendGame"></AdminGameForm>
</template>
<script lang="ts">
import { useMutation } from '@vue/apollo-composable/dist';
import { defineComponent } from '@vue/composition-api';
import AddGame from '@/graphql/mutations/addGame.gql';
import { useContext, useRouter } from '@nuxtjs/composition-api';
import { formatFormToGame } from '@/composables/services/gameService';
import { GameForm } from '~/types/type';
export default defineComponent({
  setup() {
    const {
      mutate: sendNewGame,
      onDone: onSendGameDone,
      onError: onSendGameError,
    } = useMutation(AddGame);
    const ctx = useContext();
    const router = useRouter();
    const sendGame = (form: GameForm) => {
      const payload = formatFormToGame(form);
      sendNewGame({ newGameData: payload });
    };
    onSendGameError(() => {
      ctx.$swal({
        title: 'เกิดข้อผิดผลาด',
        text: 'ไม่สามารถเพิ่มเกมได้',
        icon: 'error',
      });
    });
    onSendGameDone(() => {
      ctx.$swal({
        title: 'สำเร็จ',
        text: 'เพิ่มเกมสำเร็จ',
        timer: 1500,
        timerProgressBar: true,
        icon: 'success',
      });
      router.push('/');
    });
    return { sendGame };
  },
});
</script>
